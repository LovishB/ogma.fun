<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ogma Token Creator with Latest Tokens</title>
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Material CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #8A2BE2, #FF69B4);
            color: #333;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            padding: 20px;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            background-color: rgba(255, 255, 255, 0.9);
            border: 2px solid #FF69B4;
            overflow: hidden;
            position: relative;
        }
        .card:before {
            content: "";
            position: absolute;
            top: -10px;
            right: -10px;
            width: 80px;
            height: 80px;
            background: #FFD700;
            border-radius: 50%;
            opacity: 0.6;
            z-index: 0;
        }
        .card-title {
            font-weight: 700;
            color: #8A2BE2;
            font-size: 1.8rem;
        }
        .btn-connect {
            background-color: #FF69B4;
            border-radius: 30px;
            padding: 0 25px;
            box-shadow: 0 5px 15px rgba(255, 105, 180, 0.4);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }
        .btn-connect:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 105, 180, 0.6);
            background-color: #FF1493;
        }
        .btn-create {
            background-color: #8A2BE2;
            border-radius: 30px;
            padding: 0 25px;
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.4);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }
        .btn-create:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(138, 43, 226, 0.6);
            background-color: #7B68EE;
        }
        .btn-refresh {
            background-color: #4CAF50;
            border-radius: 30px;
            padding: 0 25px;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }
        .btn-refresh:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.6);
            background-color: #43A047;
        }
        .status-message {
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            font-weight: 500;
            animation: fadeIn 0.5s ease;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        .info {
            background-color: #e2f3f5;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }
        .hidden {
            display: none;
        }
        .loader {
            display: inline-block;
            width: 25px;
            height: 25px;
            margin-right: 8px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #FF69B4;
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .wallet-info {
            font-size: 16px;
            color: #6c5ce7;
            margin-bottom: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            animation: slideIn 0.5s ease;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .wallet-info i {
            color: #FF69B4;
            margin-right: 10px;
        }
        .header {
            margin-bottom: 30px;
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }
        .header h4 {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: 1px;
        }
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .badge-sepolia {
            background-color: #FFD700;
            color: #333;
        }
        .modal {
            border-radius: 20px;
            max-width: 500px;
            background: linear-gradient(135deg, #fff, #f0f0ff);
            max-height: 90vh !important;
            overflow-y: auto !important;
        }
        .modal-content {
            padding-bottom: 20px !important;
        }
        .modal-content h4 {
            color: #8A2BE2;
            display: flex;
            align-items: center;
        }
        .modal-content h4 i {
            margin-right: 10px;
            color: #4CAF50;
        }
        .modal-footer {
            padding: 15px 20px;
            text-align: right;
        }
        .eth-address {
            font-family: monospace;
            background: #f7f7ff;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            word-break: break-all;
            border-left: 4px solid #FF69B4;
        }
        .input-field input:focus {
            border-bottom: 1px solid #FF69B4 !important;
            box-shadow: 0 1px 0 0 #FF69B4 !important;
        }
        .input-field input:focus + label {
            color: #FF69B4 !important;
        }
        .input-field textarea:focus {
            border-bottom: 1px solid #FF69B4 !important;
            box-shadow: 0 1px 0 0 #FF69B4 !important;
        }
        .input-field textarea:focus + label {
            color: #FF69B4 !important;
        }
        .card-content {
            z-index: 1;
            position: relative;
        }
        .rocket {
            position: absolute;
            top: -50px;
            right: -30px;
            font-size: 5rem;
            opacity: 0.2;
            transform: rotate(45deg);
        }
        .moon {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 3rem;
            color: #FFD700;
            opacity: 0.7;
            z-index: -1;
        }
        .coin {
            position: fixed;
            animation: floatCoin 8s ease-in-out infinite;
            color: #FFD700;
            font-size: 2rem;
            opacity: 0.6;
            z-index: -1;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            transform-origin: center;
        }
        
        /* Different animation durations for more variety */
        .coin1, .coin4, .coin7, .coin10, .coin13 { animation-duration: 7s; }
        .coin2, .coin5, .coin8, .coin11, .coin14 { animation-duration: 8s; }
        .coin3, .coin6, .coin9, .coin12, .coin15 { animation-duration: 9s; }
        .coin1 { top: 10%; left: 5%; animation-delay: 0s; }
        .coin2 { top: 20%; right: 10%; animation-delay: 1s; }
        .coin3 { bottom: 15%; left: 15%; animation-delay: 2s; }
        .coin4 { top: 30%; left: 25%; animation-delay: 0.5s; }
        .coin5 { top: 15%; right: 20%; animation-delay: 1.5s; }
        .coin6 { bottom: 25%; left: 35%; animation-delay: 2.5s; }
        .coin7 { top: 45%; right: 15%; animation-delay: 3s; }
        .coin8 { bottom: 40%; right: 25%; animation-delay: 3.5s; }
        .coin9 { top: 60%; left: 10%; animation-delay: 4s; }
        .coin10 { top: 5%; right: 30%; animation-delay: 0.2s; }
        .coin11 { top: 70%; right: 5%; animation-delay: 1.7s; }
        .coin12 { bottom: 10%; right: 35%; animation-delay: 2.3s; }
        .coin13 { top: 25%; left: 45%; animation-delay: 1.2s; }
        .coin14 { top: 50%; right: 40%; animation-delay: 2.8s; }
        .coin15 { bottom: 30%; left: 3%; animation-delay: 3.2s; }
        
        @keyframes floatCoin {
            0% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-15px) rotate(5deg); }
            50% { transform: translateY(-30px) rotate(10deg); }
            75% { transform: translateY(-15px) rotate(5deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }
        .input-field {
            margin-bottom: 25px;
        }
        #tx-link {
            background-color: #FFD700;
            color: #333;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(255, 215, 0, 0.4);
            border-radius: 30px;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        #tx-link:hover {
            background-color: #FFC107;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 215, 0, 0.6);
        }
        
        /* New styles for latest tokens section */
        .section-title {
            color: white;
            font-size: 1.8rem;
            font-weight: 600;
            margin-top: 40px;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        /* Grid layout for tokens */
        #latest-tokens-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 992px) {
            #latest-tokens-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 600px) {
            #latest-tokens-container {
                grid-layout: 1fr;
            }
        }
        
        .token-card {
            margin: 0;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .token-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }
        .token-card:after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #FF69B4, #8A2BE2);
        }
        .token-card-content {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 15px;
        }
        .token-image-container {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }
        .token-logo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #FFD700;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            background-color: white;
        }
        .token-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            text-align: center;
        }
        .token-name {
            font-weight: 700;
            font-size: 1.2rem;
            color: #8A2BE2;
            margin: 0 0 5px 0;
        }
        .token-symbol {
            color: #FF69B4;
            font-weight: 600;
            margin: 0 0 10px 0;
        }
        .token-description {
            margin: 0 0 15px 0;
            font-size: 0.9rem;
            color: #666;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .token-meta {
            display: flex;
            flex-direction: column;
            margin-top: auto;
            font-size: 14px;
            text-align: left;
        }
        .token-meta div {
            margin-bottom: 5px;
            color: #666;
        }
        .token-meta i {
            font-size: 16px;
            margin-right: 3px;
            color: #8A2BE2;
            vertical-align: middle;
        }
        .token-placeholder {
            text-align: center;
            padding: 30px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            border: 2px dashed #FF69B4;
            color: #8A2BE2;
            font-weight: 500;
            grid-column: 1 / -1;
        }
        .token-action {
            position: absolute;
            right: 15px;
            top: 15px;
            opacity: 0;
            transition: all 0.3s ease;
        }
        .token-card:hover .token-action {
            opacity: 1;
        }
        .token-action a {
            color: #8A2BE2;
            margin-left: 10px;
            transition: all 0.3s ease;
        }
        .token-action a:hover {
            color: #FF69B4;
            transform: scale(1.2);
        }
        .token-detail-modal {
            max-width: 600px;
        }
        .token-detail-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .token-detail-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #FFD700;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-right: 20px;
            background-color: white;
        }
        .token-detail-name {
            flex-grow: 1;
        }
        .token-detail-name h4 {
            margin: 0;
            font-weight: 700;
            color: #8A2BE2;
        }
        .token-detail-name p {
            margin: 5px 0 0;
            color: #FF69B4;
            font-weight: 600;
            font-size: 18px;
        }
        .token-detail-section {
            margin-bottom: 20px;
        }
        .token-detail-section h6 {
            color: #8A2BE2;
            font-weight: 600;
            border-bottom: 2px solid #FFD700;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        .token-detail-info {
            display: flex;
            flex-wrap: wrap;
        }
        .token-detail-info div {
            width: 50%;
            margin-bottom: 10px;
        }
        .token-detail-info span.label {
            font-weight: 500;
            color: #666;
            margin-right: 5px;
        }
        .token-detail-info span.value {
            font-weight: 600;
            color: #333;
        }
        .token-description {
            background-color: #f7f7ff;
            padding: 15px;
            border-radius: 8px;
            color: #333;
            font-style: italic;
            border-left: 4px solid #8A2BE2;
        }
        .load-more {
            text-align: center;
            margin-top: 20px;
        }
        .no-tokens {
            text-align: center;
            padding: 40px 20px;
            color: white;
            font-size: 1.2rem;
            font-weight: 500;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
        .refresh-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
        }
        #tx-success-modal .modal-content {
            padding: 24px 24px 40px 24px !important;
        }
        #tx-success-modal .section {
            margin-bottom: 20px !important;
        }
        #tx-success-modal .eth-address {
            word-break: break-all;
            margin: 10px 0;
        }
        #tx-success-modal .modal-footer {
            padding: 15px 24px !important;
            border-top: 1px solid rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="moon">🌕</div>
    <div class="coin coin1">💰</div>
    <div class="coin coin2">🪙</div>
    <div class="coin coin3">💎</div>
    <div class="coin coin4">💸</div>
    <div class="coin coin5">🚀</div>
    <div class="coin coin6">⭐</div>
    <div class="coin coin7">💰</div>
    <div class="coin coin8">🪙</div>
    <div class="coin coin9">💎</div>
    <div class="coin coin10">🔥</div>
    <div class="coin coin11">🌠</div>
    <div class="coin coin12">💯</div>
    <div class="coin coin13">🤑</div>
    <div class="coin coin14">💵</div>
    <div class="coin coin15">🌟</div>
    
    <div class="container">
        <div class="header center-align">
            <h4>🚀 Ogma Token Creator <span class="badge badge-sepolia">Sepolia</span></h4>
            <p>Create your own memecoin and launch to the moon! 🌕</p>
        </div>

        <div class="card">
            <div class="card-content">
                <span class="rocket">🚀</span>
                <span class="card-title">Create Your Memecoin</span>
                
                <!-- Connect Wallet Section -->
                <div class="section">
                    <button id="connect-wallet" class="waves-effect waves-light btn btn-connect">
                        <i class="material-icons left">account_balance_wallet</i>Connect Wallet
                    </button>
                <div id="wallet-info" class="wallet-info hidden">
                        <i class="material-icons">account_balance_wallet</i> Connected: <span id="wallet-address" class="eth-address"></span>
                    </div>
                </div>

                <!-- Token Creation Form -->
                <div id="token-form" class="section hidden">
                    <div class="row">
                        <div class="input-field col s12">
                            <input id="token-name" type="text" class="validate">
                            <label for="token-name">Token Name</label>
                            <span class="helper-text">E.g., "RocketDoge" or "MoonLambo"</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <input id="token-symbol" type="text" class="validate">
                            <label for="token-symbol">Token Symbol</label>
                            <span class="helper-text">E.g., "RKTDG" or "MLMBO" (2-5 characters)</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <input id="token-uri" type="text" class="validate">
                            <label for="token-uri">Token URI</label>
                            <span class="helper-text">Link to your memecoin logo/mascot</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <textarea id="token-description" class="materialize-textarea"></textarea>
                            <label for="token-description">Token Description</label>
                            <span class="helper-text">What makes your memecoin special? Get creative!</span>
                        </div>
                    </div>
                    <button id="create-token" class="waves-effect waves-light btn btn-create">
                        <i class="material-icons left">rocket_launch</i>Launch Token
                    </button>
                </div>

                <!-- Status Messages -->
                <div id="status-message" class="status-message hidden"></div>
            </div>
        </div>

        <!-- New Section: Latest Tokens -->
        <div class="section-title">
            <div class="refresh-section">
                <h5>Latest Launched Tokens 🔥</h5>
                <button id="refresh-tokens" class="waves-effect waves-light btn btn-refresh">
                    <i class="material-icons left">refresh</i>Refresh
                </button>
            </div>
        </div>
        
        <div id="latest-tokens-container">
            <!-- Tokens will be loaded here dynamically -->
            <div class="token-placeholder">
                <i class="material-icons large">hourglass_empty</i>
                <p>Loading tokens...</p>
            </div>
        </div>
        
        <div class="load-more hidden">
            <button id="load-more-tokens" class="waves-effect waves-light btn">
                <i class="material-icons left">add</i>Load More
            </button>
        </div>
    </div>

    <!-- Transaction Success Modal -->
    <div id="tx-success-modal" class="modal">
        <div class="modal-content">
            <h4><i class="material-icons">rocket_launch</i>Your Memecoin Has Launched! 🚀</h4>
            <p>Your Ogma token is now on the blockchain and ready to moon!</p>
            <div class="section">
                <h6>Token Address:</h6>
                <p id="new-token-address" class="eth-address"></p>
            </div>
            <div class="section">
                <h6>Transaction Hash:</h6>
                <p id="tx-hash" class="eth-address"></p>
                <a id="tx-link" href="#" target="_blank" class="waves-effect waves-light btn hidden">
                    <i class="material-icons left">open_in_new</i>View on Etherscan
                </a>
            </div>
            <p>🔒 60% of your tokens are locked for 30 days, and 40% are in your wallet ready to use!</p>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-close waves-effect waves-green btn-flat">Close</a>
        </div>
    </div>

    <!-- Token Detail Modal -->
    <div id="token-detail-modal" class="modal token-detail-modal">
        <div class="modal-content">
            <div class="token-detail-header">
                <img id="detail-token-logo" src="https://emojicdn.elk.sh/%F0%9F%9A%80" alt="Token Logo" class="token-detail-logo">
                <div class="token-detail-name">
                    <h4 id="detail-token-name">Token Name</h4>
                    <p id="detail-token-symbol">SYMBOL</p>
                </div>
            </div>
            
            <div class="token-detail-section">
                <h6>Description</h6>
                <div id="detail-token-description" class="token-description">
                    Token description will appear here.
                </div>
            </div>
            
            <div class="token-detail-section">
                <h6>Token Information</h6>
                <div class="token-detail-info">
                    <div>
                        <span class="label">Contract Address:</span>
                        <span id="detail-token-address" class="value eth-address"></span>
                    </div>
                    <div>
                        <span class="label">Creator:</span>
                        <span id="detail-token-owner" class="value eth-address"></span>
                    </div>
                    <div>
                        <span class="label">Total Supply:</span>
                        <span id="detail-token-supply" class="value"></span>
                    </div>
                    <div>
                        <span class="label">Locked Supply:</span>
                        <span id="detail-token-locked" class="value"></span>
                    </div>
                    <div>
                        <span class="label">Unlock Date:</span>
                        <span id="detail-token-unlock" class="value"></span>
                    </div>
                </div>
            </div>
            
            <div class="token-detail-section">
                <h6>Actions</h6>
                <div class="row">
                    <div class="col s12">
                        <a id="detail-token-etherscan" href="#" target="_blank" class="waves-effect waves-light btn">
                            <i class="material-icons left">open_in_new</i>View on Etherscan
                        </a>
                        <a id="detail-token-add" href="#" class="waves-effect waves-light btn">
                            <i class="material-icons left">add_circle</i>Add to Wallet
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-close waves-effect waves-green btn-flat">Close</a>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    
    <script>
        // Initialize Materialize components
        document.addEventListener('DOMContentLoaded', function() {
            var modals = document.querySelectorAll('.modal');
            M.Modal.init(modals);
        });
        
        // Wallet connection and token creation logic
        const connectWalletBtn = document.getElementById('connect-wallet');
        const createTokenBtn = document.getElementById('create-token');
        const refreshTokensBtn = document.getElementById('refresh-tokens');
        const loadMoreTokensBtn = document.getElementById('load-more-tokens');
        const tokenForm = document.getElementById('token-form');
        const walletInfo = document.getElementById('wallet-info');
        const walletAddress = document.getElementById('wallet-address');
        const statusMessage = document.getElementById('status-message');
        const latestTokensContainer = document.getElementById('latest-tokens-container');
        const txSuccessModal = document.getElementById('tx-success-modal');
        const tokenDetailModal = document.getElementById('token-detail-modal');
        
        // Contract addresses and ABIs would be defined here
        const factoryContractAddress = '0xCE86EF8A6e62a074AAc72207eBCa824FE288e6E1'; // Token factory contract address
        const factoryContractABI = [
        {
                "inputs": [
                    {"internalType": "string", "name": "_tokenName", "type": "string"},
                    {"internalType": "string", "name": "_tokenSymbol", "type": "string"},
                    {"internalType": "string", "name": "_tokenURI", "type": "string"},
                    {"internalType": "string", "name": "_tokenDescription", "type": "string"}
                ],
                "name": "createToken",
                "outputs": [{"internalType": "address", "name": "", "type": "address"}],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ]; // ABI array
        
        // Add storage contract address and ABI
        const storageContractAddress = '0x15f73D946CA714BccF12063537D39576b3E2224D'; // Replace with actual address if different
        const storageContractABI = [
            {
                "inputs": [
                    {"internalType": "uint256", "name": "_count", "type": "uint256"}
                ],
                "name": "getLatestTokens",
                "outputs": [
                    {"internalType": "address[]", "name": "addresses", "type": "address[]"},
                    {
                        "components": [
                            {"internalType": "string", "name": "name", "type": "string"},
                            {"internalType": "string", "name": "symbol", "type": "string"},
                            {"internalType": "string", "name": "uri", "type": "string"},
                            {"internalType": "string", "name": "description", "type": "string"},
                            {"internalType": "address", "name": "owner", "type": "address"},
                            {"internalType": "uint256", "name": "totalSupply", "type": "uint256"},
                            {"internalType": "uint256", "name": "lockedSupply", "type": "uint256"},
                            {"internalType": "uint256", "name": "unlockDate", "type": "uint256"}
                        ],
                        "internalType": "struct OgmaStorage.TokenInfo[]",
                        "name": "infos",
                        "type": "tuple[]"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getTokenCount",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [{"internalType": "address", "name": "_tokenAddress", "type": "address"}],
                "name": "getTokenInfo",
                "outputs": [
                    {
                        "components": [
                            {"internalType": "string", "name": "name", "type": "string"},
                            {"internalType": "string", "name": "symbol", "type": "string"},
                            {"internalType": "string", "name": "uri", "type": "string"},
                            {"internalType": "string", "name": "description", "type": "string"},
                            {"internalType": "address", "name": "owner", "type": "address"},
                            {"internalType": "uint256", "name": "totalSupply", "type": "uint256"},
                            {"internalType": "uint256", "name": "lockedSupply", "type": "uint256"},
                            {"internalType": "uint256", "name": "unlockDate", "type": "uint256"}
                        ],
                        "internalType": "struct OgmaStorage.TokenInfo",
                        "name": "",
                        "type": "tuple"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ];
        
        let currentPage = 1;
        let tokensPerPage = 10;
        let provider, signer, factoryContract, storageContract;
        
        // Connect wallet function
        connectWalletBtn.addEventListener('click', async () => {
            try {
                // Request access to user's wallet
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                // Initialize ethers provider and signer
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                const address = await signer.getAddress();
                
                // Initialize contracts
                factoryContract = new ethers.Contract(
                    factoryContractAddress,
                    factoryContractABI,
                    signer
                );
                storageContract = new ethers.Contract(
                    storageContractAddress,
                    storageContractABI,
                    signer
                );
                
                // Update UI to show connected wallet
                walletAddress.textContent = `${address.substring(0, 6)}...${address.substring(38)}`;
                connectWalletBtn.classList.add('hidden');
                walletInfo.classList.remove('hidden');
                tokenForm.classList.remove('hidden');
                
                showStatusMessage('Wallet connected successfully!', 'success');
                
                // Load latest tokens
                loadLatestTokens();
            } catch (error) {
                console.error(error);
                showStatusMessage('Failed to connect wallet. Please try again.', 'error');
            }
        });
        
        // Create token function
        createTokenBtn.addEventListener('click', async () => {
            const tokenName = document.getElementById('token-name').value.trim();
            const tokenSymbol = document.getElementById('token-symbol').value.trim().toUpperCase();
            const tokenURI = document.getElementById('token-uri').value.trim();
            const tokenDescription = document.getElementById('token-description').value.trim();
            
            // Validate input
            if (!tokenName || !tokenSymbol || !tokenURI || !tokenDescription) {
                showStatusMessage('Please fill in all fields', 'error');
                return;
            }
            
            try {
                // Show loading state
                createTokenBtn.disabled = true;
                createTokenBtn.innerHTML = '<div class="loader"></div>Creating...';
                showStatusMessage('Creating your token, please confirm the transaction...', 'info');
                
                // Call contract function to create token
                const tx = await factoryContract.createToken(
                    tokenName,
                    tokenSymbol,
                    tokenURI,
                    tokenDescription
                );
                
                showStatusMessage('Transaction submitted! Waiting for confirmation...', 'info');
                
                // Wait for transaction to be mined
                const receipt = await tx.wait();
                
                // Get the token address from event logs
                const tokenAddress = '0x...'; // Parse from receipt events
                
                // Show success modal
                document.getElementById('new-token-address').textContent = tokenAddress;
                document.getElementById('tx-hash').textContent = tx.hash;
                document.getElementById('tx-link').href = `https://sepolia.etherscan.io/tx/${tx.hash}`;
                document.getElementById('tx-link').classList.remove('hidden');
                
                const instance = M.Modal.getInstance(txSuccessModal);
                instance.open();
                
                // Reset form
                document.getElementById('token-name').value = '';
                document.getElementById('token-symbol').value = '';
                document.getElementById('token-uri').value = '';
                document.getElementById('token-description').value = '';
                
                // Refresh token list
                loadLatestTokens();
            } catch (error) {
                console.error(error);
                showStatusMessage('Failed to create token. Please try again.', 'error');
            } finally {
                createTokenBtn.disabled = false;
                createTokenBtn.innerHTML = '<i class="material-icons left">rocket_launch</i>Launch Token';
            }
        });
        
        // Function to show status messages
        function showStatusMessage(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            statusMessage.classList.remove('hidden');
            
            // Hide message after 5 seconds
            setTimeout(() => {
                statusMessage.classList.add('hidden');
            }, 5000);
        }
        
        // Function to load latest tokens
        async function loadLatestTokens(page = 1) {
            try {
                if (page === 1) {
                    latestTokensContainer.innerHTML = `
                        <div class="token-placeholder">
                            <i class="material-icons large">hourglass_empty</i>
                            <p>Loading tokens...</p>
                        </div>
                    `;
                }
                
                // Initialize provider if not already initialized
                if (!provider) {
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                }
                
                // Initialize storage contract if not already initialized
                if (!storageContract) {
                    storageContract = new ethers.Contract(
                        storageContractAddress,
                        storageContractABI,
                        provider
                    );
                }
                
                // Always use a count of 10 tokens
                const count = 10;
                
                // Call contract to get latest tokens
                const [addresses, infos] = await storageContract.getLatestTokens(count);
                
                // Debug: Log the token data
                console.log("Token addresses:", addresses);
                console.log("Token infos:", infos);
                
                // Convert contract data to token objects
                const tokens = addresses.map((address, index) => {
                    const info = infos[index];
                    
                    // Debug: Log each token's URI
                    console.log(`Token ${index} URI:`, info.uri);
                    
                    return {
                        address: address,
                        name: info.name,
                        symbol: info.symbol,
                        uri: info.uri,
                        description: info.description,
                        creator: info.owner,
                        totalSupply: info.totalSupply,
                        lockedSupply: info.lockedSupply,
                        unlockDate: info.unlockDate
                    };
                });
                
                if (tokens.length === 0 && page === 1) {
                    latestTokensContainer.innerHTML = `
                        <div class="no-tokens">
                            <i class="material-icons large">sentiment_dissatisfied</i>
                            <p>No tokens found. Be the first to create one!</p>
                        </div>
                    `;
                    document.querySelector('.load-more').classList.add('hidden');
                    return;
                }
                
                if (page === 1) {
                    latestTokensContainer.innerHTML = '';
                }
                
                // Display tokens
                tokens.forEach(token => {
                    const tokenCard = createTokenCard(token);
                    latestTokensContainer.appendChild(tokenCard);
                });
                
                // Show/hide load more button
                if (tokens.length === count) {
                    document.querySelector('.load-more').classList.remove('hidden');
                } else {
                    document.querySelector('.load-more').classList.add('hidden');
                }
                
                currentPage = page;
            } catch (error) {
                console.error("Error loading tokens:", error);
                latestTokensContainer.innerHTML = `
                    <div class="no-tokens">
                        <i class="material-icons large">error</i>
                        <p>Error loading tokens. Please try again.</p>
                    </div>
                `;
            }
        }
        
        // Function to create token card element
        function createTokenCard(token) {
            const div = document.createElement('div');
            div.className = 'token-card card';
            
            // Format the unlock date
            const unlockDate = new Date(token.unlockDate * 1000);
            const formattedDate = unlockDate.toLocaleDateString();
            
            // Determine which image to use based on token symbol
            const rocketEmojiUrl = 'https://emojicdn.elk.sh/%F0%9F%9A%80';
            const specialSymbols = ['OGMA', 'RKTDG', 'AVT', 'PEPE'];
            const imageUrl = specialSymbols.includes(token.symbol) ? rocketEmojiUrl : token.uri;
            
            div.innerHTML = `
                <div class="token-card-content">
                    <div class="token-image-container">
                        <img src="${imageUrl}" alt="${token.name}" class="token-logo">
                    </div>
                    <div class="token-info">
                        <h5 class="token-name">${token.name}</h5>
                        <p class="token-symbol">${token.symbol}</p>
                        <p class="token-description">${token.description}</p>
                        <div class="token-meta">
                            <div><i class="material-icons tiny">account_circle</i> ${token.creator.substring(0, 6)}...${token.creator.substring(38)}</div>
                            <div><i class="material-icons tiny">lock</i> Locked until: ${formattedDate}</div>
                            <div><i class="material-icons tiny">inventory_2</i> ${ethers.utils.formatEther(token.totalSupply)} ${token.symbol}</div>
                        </div>
                    </div>
                    <div class="token-action">
                        <a href="#" class="view-details" data-token-address="${token.address}"><i class="material-icons">info</i></a>
                        <a href="https://sepolia.etherscan.io/token/${token.address}" target="_blank"><i class="material-icons">open_in_new</i></a>
                    </div>
                </div>
            `;
            
            // Add event listener for view details button
            div.querySelector('.view-details').addEventListener('click', (e) => {
                e.preventDefault();
                showTokenDetails(token.address);
            });
            
            return div;
        }
        
        // Function to show token details
        async function showTokenDetails(tokenAddress) {
            try {
                // Initialize provider if not already initialized
                if (!provider) {
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                }
                
                // Initialize storage contract if not already initialized
                if (!storageContract) {
                    storageContract = new ethers.Contract(
                        storageContractAddress,
                        storageContractABI,
                        provider
                    );
                }
                
                // Fetch token details from contract
                const tokenInfo = await storageContract.getTokenInfo(tokenAddress);
                
                // Determine which image to use based on token symbol
                const rocketEmojiUrl = 'https://emojicdn.elk.sh/%F0%9F%9A%80';
                const specialSymbols = ['OGMA', 'RKTDG', 'AVT', 'PEPE'];
                const imageUrl = specialSymbols.includes(tokenInfo.symbol) ? rocketEmojiUrl : tokenInfo.uri;
                
                // Update modal with token details
                document.getElementById('detail-token-logo').src = imageUrl;
                document.getElementById('detail-token-name').textContent = tokenInfo.name;
                document.getElementById('detail-token-symbol').textContent = tokenInfo.symbol;
                document.getElementById('detail-token-description').textContent = tokenInfo.description;
                document.getElementById('detail-token-address').textContent = tokenAddress;
                document.getElementById('detail-token-owner').textContent = tokenInfo.owner;
                document.getElementById('detail-token-supply').textContent = `${ethers.utils.formatEther(tokenInfo.totalSupply)} ${tokenInfo.symbol}`;
                document.getElementById('detail-token-locked').textContent = `${ethers.utils.formatEther(tokenInfo.lockedSupply)} ${tokenInfo.symbol} (60%)`;
                
                const unlockDate = new Date(tokenInfo.unlockDate * 1000);
                document.getElementById('detail-token-unlock').textContent = unlockDate.toLocaleDateString();
                
                document.getElementById('detail-token-etherscan').href = `https://sepolia.etherscan.io/token/${tokenAddress}`;
                
                // Add to wallet function
                document.getElementById('detail-token-add').onclick = async () => {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_watchAsset',
                            params: {
                                type: 'ERC20',
                                options: {
                                    address: tokenAddress,
                                    symbol: tokenInfo.symbol,
                                    decimals: 18,
                                    image: imageUrl // Use the same conditional image URL here
                                }
                            }
                        });
                    } catch (error) {
                        console.error(error);
                    }
                };
                
                // Show modal
                const instance = M.Modal.getInstance(tokenDetailModal);
                instance.open();
            } catch (error) {
                console.error(error);
                showStatusMessage('Failed to load token details', 'error');
            }
        }
        
        // Refresh tokens button
        refreshTokensBtn.addEventListener('click', () => {
            loadLatestTokens();
        });
        
        // Load more tokens button
        loadMoreTokensBtn.addEventListener('click', () => {
            loadLatestTokens(currentPage + 1);
        });
        
        // Check if wallet is already connected on page load
        window.addEventListener('load', async () => {
            // Load tokens regardless of wallet connection
            loadLatestTokens();
            
            if (window.ethereum && window.ethereum.isConnected()) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        // Auto-connect if account is available
                        connectWalletBtn.click();
                    }
                } catch (error) {
                    console.error(error);
                }
            }
        });
    </script>
</body>
</html>